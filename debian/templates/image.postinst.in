#!/bin/sh -e

version=@abiname@@localversion@
image_path=/boot/@image-stem@-$version

if [ "$1" != configure ]; then
    exit 0
fi

# Workaround for bug #817083 - ensure debconf template is loaded now
# so we can use it in prerm script.
. /usr/share/debconf/confmodule

depmod $version

if [ -z "$2" ]; then
    change=install
else
    change=upgrade
fi
linux-update-symlinks $change $version $image_path

if [ -d /etc/kernel/postinst.d ]; then
    DEB_MAINT_PARAMS="$*" run-parts --report --exit-on-error --arg=$version \
	      --arg=$image_path /etc/kernel/postinst.d
fi

exit 0
