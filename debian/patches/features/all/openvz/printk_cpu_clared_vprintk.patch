From: Marat Stanichenko <mstanichenko@openvz.org>
Date: Wed, 3 Feb 2010 17:22:40 +0000 (+0300)
Subject: printk_cpu have to be "cleared" in __vprintk (v2)
X-Git-Tag: spawn-2.6.32~1
X-Git-Url: http://git.openvz.org/?p=linux-2.6.27-openvz;a=commitdiff_plain;h=05753c5c2a5ab261ba6500243a8c235c139d49ad;hp=f13d855c2d1e3fcab932396d3116a18e6c01fa42

printk_cpu have to be "cleared" in __vprintk (v2)

http://bugzilla.openvz.org/show_bug.cgi?id=1284
---

diff --git a/kernel/printk.c b/kernel/printk.c
index 7ab9835..f2bf3d9 100644
--- a/kernel/printk.c
+++ b/kernel/printk.c
@@ -1148,6 +1148,7 @@ void release_console_sem(void)
 		_con_start = con_start;
 		_log_end = log_end;
 		con_start = log_end;		/* Flush */
+		printk_cpu = UINT_MAX;
 		spin_unlock(&logbuf_lock);
 		call_console_drivers(_con_start, _log_end);
 		local_irq_restore(flags);
