From c5c1032d4b6519d1e3a37853c5c0fd7fbd1f8798 Mon Sep 17 00:00:00 2001
From: Vitaliy Gusev <vgusev@openvz.org>
Date: Tue, 13 Jan 2009 18:23:55 +0300
Subject: [PATCH] Don't dereference NULL tsk->mm in ve_move_task

Kthreads are mmless...

Signed-off-by: Vitaliy Gusev <vgusev@openvz.org>
Signed-off-by: Pavel Emelyanov <xemul@openvz.org>
---
 kernel/ve/vecalls.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/kernel/ve/vecalls.c b/kernel/ve/vecalls.c
index 376bbfb..34bcbcd 100644
--- a/kernel/ve/vecalls.c
+++ b/kernel/ve/vecalls.c
@@ -883,7 +883,8 @@ void ve_move_task(struct task_struct *tsk, struct ve_struct *new)
 	BUG_ON(!(thread_group_leader(tsk) && thread_group_empty(tsk)));
 
 	/* this probihibts ptracing of task entered to VE from host system */
-	tsk->mm->vps_dumpable = 0;
+	if (tsk->mm)
+		tsk->mm->vps_dumpable = 0;
 	/* setup capabilities before enter */
 	set_task_ve_caps(tsk, new);
 
-- 
1.6.0.6

