From: Ben Hutchings <ben@decadent.org.uk>
Date: Wed, 14 Feb 2018 20:22:42 +0000
Subject: block: Avoid ABI change in 3.2.99
Forwarded: not-needed

Commit 5acb3cc2c2e9 ("blktrace: Fix potential deadlock between delete
& sysfs ops") added a new member in the middle of struct
request_queue.  This structure is always allocated by built-in code,
and the new member is only used by built-in code, so we can add the
new member at the end without an ABI change.  So move it to the end
and hide it from genksyms.

---
--- a/include/linux/blkdev.h
+++ b/include/linux/blkdev.h
@@ -361,7 +361,6 @@ struct request_queue {
 	int			node;
 #ifdef CONFIG_BLK_DEV_IO_TRACE
 	struct blk_trace	*blk_trace;
-	struct mutex		blk_trace_mutex;
 #endif
 	/*
 	 * for flush operations
@@ -388,6 +387,12 @@ struct request_queue {
 	/* Throttle data */
 	struct throtl_data *td;
 #endif
+
+#ifndef __GENKSYMS__
+#ifdef CONFIG_BLK_DEV_IO_TRACE
+	struct mutex		blk_trace_mutex;
+#endif
+#endif
 };
 
 #define QUEUE_FLAG_QUEUED	1	/* uses generic tag queueing */
