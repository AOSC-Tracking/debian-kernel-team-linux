From: Ben Hutchings <ben@decadent.org.uk>
Date: Wed, 25 Apr 2018 18:38:04 +0100
Subject: scsi: libsas: Avoid ABI change for CVE-2017-18232 fix
Forwarded: not-needed

Restore the old numbering in enum discover_event to avoid an ABI
change.  Also make numbering explicit again in enum port_event and
enum phy_event, as I don't think genksyms is smart enough to recognise
that the implictly numbered definitions are equivalent.

---
--- a/include/scsi/libsas.h
+++ b/include/scsi/libsas.h
@@ -67,29 +67,35 @@ enum ha_event {
 
 enum port_event {
 	PORTE_BYTES_DMAED     = 0U,
-	PORTE_BROADCAST_RCVD,
-	PORTE_LINK_RESET_ERR,
-	PORTE_TIMER_EVENT,
-	PORTE_HARD_RESET,
-	PORT_NUM_EVENTS,
+	PORTE_BROADCAST_RCVD  = 1,
+	PORTE_LINK_RESET_ERR  = 2,
+	PORTE_TIMER_EVENT     = 3,
+	PORTE_HARD_RESET      = 4,
+	PORT_NUM_EVENTS       = 5,
 };
 
 enum phy_event {
 	PHYE_LOSS_OF_SIGNAL   = 0U,
-	PHYE_OOB_DONE,
-	PHYE_OOB_ERROR,
-	PHYE_SPINUP_HOLD,             /* hot plug SATA, no COMWAKE sent */
-	PHYE_RESUME_TIMEOUT,
-	PHY_NUM_EVENTS,
+	PHYE_OOB_DONE	      = 1,
+	PHYE_OOB_ERROR	      = 2,
+	PHYE_SPINUP_HOLD      = 3,    /* hot plug SATA, no COMWAKE sent */
+	PHYE_RESUME_TIMEOUT   = 4,
+	PHY_NUM_EVENTS	      = 5,
 };
 
 enum discover_event {
 	DISCE_DISCOVER_DOMAIN   = 0U,
-	DISCE_REVALIDATE_DOMAIN,
-	DISCE_PORT_GONE,
-	DISCE_SUSPEND,
-	DISCE_RESUME,
-	DISC_NUM_EVENTS,
+	DISCE_REVALIDATE_DOMAIN	= 1,
+	DISCE_PORT_GONE		= 2,
+#ifdef __GENKSYMS__
+	DISCE_PROBE		= 3,
+#endif
+	DISCE_SUSPEND		= 4,
+	DISCE_RESUME		= 5,
+#ifdef __GENKSYMS__
+	DISCE_DESTRUCT		= 6,
+#endif
+	DISC_NUM_EVENTS		= 7,
 };
 
 /* ---------- Expander Devices ---------- */
