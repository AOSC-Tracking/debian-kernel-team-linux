commit 280e667abc35af480c59d86fc63b4130ecb9e6bf
Author: dann frazier <dannf@hp.com>
Date:   Sun Feb 14 12:49:24 2010 -0700

    [Adjusted to apply to Debian's 2.6.24 by dann frazier <dannf@debian.org>]
    
      commit 51246bfd189064079c54421507236fd2723b18f3
      Author: Thomas Gleixner <tglx@linutronix.de>
      Date:   Tue Feb 2 11:40:27 2010 +0100
    
          futex: Handle user space corruption gracefully

diff --git a/kernel/futex.c b/kernel/futex.c
index bfc785b..0fdae3e 100644
--- a/kernel/futex.c
+++ b/kernel/futex.c
@@ -636,6 +636,13 @@ static int wake_futex_pi(u32 __user *uaddr, u32 uval, struct futex_q *this)
 	if (!pi_state)
 		return -EINVAL;
 
+	/*
+	 * If current does not own the pi_state then the futex is
+	 * inconsistent and user space fiddled with the futex value.
+	 */
+	if (pi_state->owner != current)
+		return -EINVAL;
+
 	spin_lock(&pi_state->pi_mutex.wait_lock);
 	new_owner = rt_mutex_next_owner(&pi_state->pi_mutex);
 
